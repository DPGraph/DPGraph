<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>DPGraph</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/modern-business.css" rel="stylesheet">

  <!-- Vega -->
  <script src="https://vega.github.io/vega/vega.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@5"></script>

  <!-- Plotly-->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<script>
  function hideoption(){
    document.getElementById("show_algorithm").style.visibility = "hidden";
    document.getElementById("select_algorithm_DD").style.visibility = "hidden";
    //document.getElementById("select_algorithm_DD_edge").style.visibility = "hidden";
    //document.getElementById("algorithm1").label = "testing";
    document.getElementById("algorithm1").checked = false;
    document.getElementById("algorithm1").style.visibility = "hidden";
    document.getElementById("algorithm2").style.visibility = "hidden";
    document.getElementById("algorithm3").style.visibility = "hidden";
    document.getElementById("algorithm4").style.visibility = "hidden";
    document.getElementById("algorithm5").style.visibility = "hidden";
    document.getElementById("algorithm6").style.visibility = "hidden";
    document.getElementById("algorithm2").checked = false;
    document.getElementById("algorithm3").checked = false;
    document.getElementById("algorithm4").checked = true;
    document.getElementById("algorithm5").checked = true;
    document.getElementById("algorithm6").checked = true;
  }
 
  function prepare(){
    hideoption();
    document.getElementById("gif").style.visibility = "hidden";
    document.getElementById("true_explain").style.visibility = "hidden";
    document.getElementById("noisy_explain").style.visibility = "hidden";
    document.getElementById("noisy_detail").style.visibility = "hidden";
  }
</script>
<body onload = "frontierFn()">

  <!-- Navigation -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">DPGraph</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="problem.html">Problem Statement</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="frontier.html">Accuracy Frontier</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="performance.html">Performance Frontier</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownPortfolio" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Empirical Findings
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownPortfolio">
              <a class="dropdown-item" href="finding.html">Finding Overview</a>
              <a class="dropdown-item" href="#">Competitive Algorithm</a>
              <a class="dropdown-item" href="#">Effect of Data Shape</a>
              <a class="dropdown-item" href="#">Comparison Against Baseline</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownBlog" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Background Overview
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownBlog">
              <a class="dropdown-item" href="glossary.html">Reference: Glossary</a>
              <a class="dropdown-item" href="dataset.html">Reference: Dataset</a>
              <a class="dropdown-item" href="algorithm.html">Reference: Algorithms</a>
              <a class="dropdown-item" href="DPdefinition.html">Reference: Differential Privacy</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <!-- Page Content -->
  <div class="container">

    <!-- Following are some text describing how we are interact with the privacy frontier. -->

    <h1 class="text-left">Privacy Accuracy Frontier</h1>
        <p class="text-left" style= "background-color: PowderBlue"> Given a dataset and a privacy level (epsilon), which algorithm introduce the least error?
        </p>

        <p class="text-left"> We show below (on the right) the Privacy Accuracy Frontier which is a representation of the best achievable error across different privacy levels (i.e., epsilon values). It plots the error over degree distribution, or subgraph counting, of various algorithms on the chosen input dataset (y-axis) versus the privacy level (epsilon) on the x-axis. </p>

        <p class="text-left"> User first needs to specify which statistics they are interested in investigating (degree distribution of subgraph counting). Then, a privacy accuracy frontier corresponding to that statistic is generated on the right. </p>

        <p class="text-left"> Each dot corresponds to the error of a specific algorithm at a specific epsilon. For the task of degree distribution, Click on a dot to visualize the noisy histogram of the algorithm in the middle. Dots corresponding to the same epsilon are placed along the same vertical line, and dots corresponding to the same algorithms all share the same unique color. *The points that make up the lower convex hull are those that achieve the least error at that privacy level, and are called the frontier. The points on the frontier alone can be visualized by toggling the visualize frontier checkbox on the far right. Click the "Show/Hide Algorithms" button to view the list of algorithms. Algorithms can be included or excluded from the plot using the associated check-boxes.* </p>

        <p class="text-left"> For degree distribution, two histograms are shown. The true degree distribution histogram is shown on the left. The noisy degree distribution histogram is shown in the middle. * Both histograms contain the same number of bins for easier comparison. Clicking on a bin of a histogram displays the number of counts in that bin. *For subgraph counting, the subgraph is plotted on the left. In the middle, the true count and the noisy count are shown next to each other. </p>

        
        <select id = "Degree Type" onchange = "frontierFn()"> 
        <option value = "1" selected = "selected">Node DP</option>
        <option value = "2">Edge DP</option>
        
        </select>

        <select id = "Utility" onchange = "frontierFn()"> 
        <option value = "1" selected = "selected">Degree Distribution</option>
        <option value = "4">Subgraph Counting_4kclique</option>
        <option value = "3">Subgraph Counting_3kstar</option>
        <option value = "5">Subgraph Counting_2ktriangle</option>
        <option value = "2">Subgraph Counting_0ktriangle</option>
        </select>

        <select id = "Dataset" onchange = "frontierFn()"> 
        <option value = "1" >FACEBOOK</option>
        <option value = "2">CIT</option>
        <option value = "3">DBLP</option>
        <option value = "4">WIKI</option>
        <option value = "5">Toydata</option>
        <option value = "6">Email_enron</option>
        </select>
        
        <!-- 
        After clicking on the folloiwng button, user sees the privacy frontier, the true/noisy DD Hist, as well as a graph
        of the original dataset, given that they have entered valid input settings. 
        -->

        <!--<button onclick="frontierFn()">Apply Setting</button>-->

        <br>
        <script>
          
        </script>
        
        <script>
          var data = {};
          var curveChosen = '';
          var eChosen = '';
          var rankChosen = '';
          var time = 6;
          var algoindex = {};
          var algorithms = {};
          var edgealgoindex = {};
          var edgealgorithms = {};        
          function getxrange(){
            var temp_data = document.getElementById("Dataset").value;
            if(temp_data == 1) return [0,300]
            else if(temp_data == 2) return [0,200]
            else if(temp_data == 3) return [0,100]
            else if(temp_data == 4) return [0,300]
            else if(temp_data == 5) return [0,10]
            else if(temp_data == 6) return [0,300]
          }
          function getyrange(){
            var temp_data = document.getElementById("Dataset").value;
            if(temp_data == 1) return [0,120]
            else if(temp_data == 2) return [0,1500]
            else if(temp_data == 3) return [0,10000]
            else if(temp_data == 4) return [0,300]
            else if(temp_data == 5) return [0,5]
            else if(temp_data == 6) return [0,500]
          }
          function show_algorithm(){
            var dp_chosen = document.getElementById("Degree Type").value;
            var temp_query = document.getElementById("Utility").value;
            if(document.getElementById("select_algorithm_DD").style.visibility != "visible"){
              document.getElementById("select_algorithm_DD").style.visibility = "visible";
              document.getElementById("algorithm3").style.visibility = "visible";
              document.getElementById("algorithm4").style.visibility = "visible";
              document.getElementById("algorithm5").style.visibility = "visible";
              document.getElementById("algorithm6").style.visibility = "visible";
              document.getElementById("algorithm1").style.visibility = "visible";
              document.getElementById("algorithm2").style.visibility = "visible";
              if(dp_chosen == 1 && temp_query == 1) {
                document.getElementById("nodedp_algo1").style.display = "inline";
                document.getElementById("edgedp_algo1").style.display = "none";
                document.getElementById("sgcedgedp_algo1").style.display = "none";
                document.getElementById("nodedp_algo2").style.display = "inline";
                document.getElementById("edgedp_algo2").style.display = "none";
                document.getElementById("sgcedgedp_algo2").style.display = "none";
                document.getElementById("algorithm3").style.visibility = "visible";
                document.getElementById("nodedp_algo3").style.display = "inline";
                document.getElementById("sgcedgedp_algo3").style.display = "none";
                document.getElementById("algorithm4").style.visibility = "visible";
                document.getElementById("nodedp_algo4").style.display = "inline";
                document.getElementById("algorithm5").style.visibility = "visible";
                document.getElementById("nodedp_algo5").style.display = "inline";
                document.getElementById("algorithm6").style.visibility = "visible";
                document.getElementById("nodedp_algo6").style.display = "inline";
              } 
              else if(dp_chosen == 2 && temp_query == 1){
                document.getElementById("nodedp_algo1").style.display = "none";
                document.getElementById("edgedp_algo1").style.display = "inline";
                document.getElementById("sgcedgedp_algo1").style.display = "none";
                document.getElementById("nodedp_algo2").style.display = "none";
                document.getElementById("edgedp_algo2").style.display = "inline";
                document.getElementById("sgcedgedp_algo2").style.display = "none";
                document.getElementById("algorithm3").style.visibility = "hidden";
                document.getElementById("sgcedgedp_algo3").style.display = "none";
                document.getElementById("nodedp_algo3").style.display = "none";
                document.getElementById("algorithm4").style.visibility = "hidden";
                document.getElementById("nodedp_algo4").style.display = "none";
                document.getElementById("algorithm5").style.visibility = "hidden";
                document.getElementById("nodedp_algo5").style.display = "none";
                document.getElementById("algorithm6").style.visibility = "hidden";
                document.getElementById("nodedp_algo6").style.display = "none";
              }
              else if(dp_chosen == 2 && temp_query != 1){
                document.getElementById("nodedp_algo1").style.display = "none";
                document.getElementById("edgedp_algo1").style.display = "none";
                document.getElementById("sgcedgedp_algo1").style.display = "inline";
                document.getElementById("nodedp_algo2").style.display = "none";
                document.getElementById("edgedp_algo2").style.display = "none";
                document.getElementById("sgcedgedp_algo2").style.display = "inline";
                document.getElementById("sgcedgedp_algo3").style.display = "inline";
                document.getElementById("nodedp_algo3").style.display = "none";
                document.getElementById("algorithm4").style.visibility = "hidden";
                document.getElementById("nodedp_algo4").style.display = "none";
                document.getElementById("algorithm5").style.visibility = "hidden";
                document.getElementById("nodedp_algo5").style.display = "none";
                document.getElementById("algorithm6").style.visibility = "hidden";
                document.getElementById("nodedp_algo6").style.display = "none";
              }
            } else {
              document.getElementById("select_algorithm_DD").style.visibility = "hidden";
              document.getElementById("algorithm3").style.visibility = "hidden";
              document.getElementById("algorithm4").style.visibility = "hidden";
              document.getElementById("algorithm5").style.visibility = "hidden";
              document.getElementById("algorithm6").style.visibility = "hidden";
              document.getElementById("algorithm1").style.visibility = "hidden";
              document.getElementById("algorithm2").style.visibility = "hidden";
              
            }
          }
          function plotfrontier(dataChosen){
            var dp_chosen = document.getElementById("Degree Type").value;
            var temp_query = document.getElementById("Utility").value;
            var dataset = dataChosen;
            if(temp_query != 1) dataChosen = dataChosen + "SGC"
            if(dp_chosen == 2)var csvName = dataChosen + "edge.csv";
            else var csvName = dataChosen + ".csv";
            Plotly.d3.csv(csvName, (err, rows) => {
              var tempPlot = document.getElementById('scatterFrontier')
              function getcolor(y){
                if(y==1)return 'blue';
                else if(y==2) return 'orange';
                else if(y==3) return 'green';
                else if(y==4) return 'red';
                else if(y==5) return 'purple';
                else if(y==6) return 'brown';
              }
              if(dp_chosen == 1){
                var data = algoindex.map(y => {
                  var d = rows.filter(r => r.algorithm == y)
                  var l = rows.filter(r => (r.query == temp_query-1) && (r.algorithm == y))
                  function filter_x(){
                    if(temp_query==1) return d.map(r => r.epsilon)
                    else return l.map(r => r.epsilon)
                  } 
                  function filter_y(){
                    if(temp_query==1) return d.map(r => r.L1error)
                    else return l.map(r => r.L1error)
                  }   
                  function filter_error(){
                    if(temp_query==1) return d.map(r => r.L1error_sd)
                    else return l.map(r => r.L1error_sd)
                  }
                  return {
                    name: algorithms[y-1],
                    x: filter_x(),
                    y: filter_y(),
                    color: getcolor(y),
                    error_y: {
                      type: 'data',
                      array: filter_error(),
                      visible: true
                    },
                    type: 'dotplot',
                  }
                })
              } else {
                var data = edgealgoindex.map(y => {
                  var d = rows.filter(r => r.algorithm == y)
                  var l = rows.filter(r => (r.query == temp_query-1) && (r.algorithm == y))
                  function filter_x(){
                    if(temp_query==1) return d.map(r => r.epsilon)
                    else return l.map(r => r.epsilon)
                  } 
                  function filter_y(){
                    if(temp_query==1) return d.map(r => r.L1error)
                    else return l.map(r => r.L1error)
                  }   
                  function filter_error(){
                    if(temp_query==1) return d.map(r => r.L1error_sd)
                    else return l.map(r => r.L1error_sd)
                  }
                  return {
                    name: algorithms[y-1],
                    x: filter_x(),
                    y: filter_y(),
                    color: getcolor(y),
                    error_y: {
                      type: 'data',
                      array: filter_error(),
                      visible: true
                    },
                    type: 'scatter',
                  }
                })
              }
              function errorrange(){
                if(temp_query == 1) return [0,3]
                else return [0, 1]
              }
              function gettitle(){
                if(temp_query == 1) return 'L1error';
                else return 'Relative error';
              }
              console.log(data);
              var layout = {
                autosize: false,
                width: 300,
                height: 300,
                xaxis: {
                  type: 'log',
                  title: 'epsilon',
                  autorange: true,
                  tickangle: 'auto',
                  tickfont: {
                    family: 'Old Standard TT, serif',
                    size: 14,
                    color: 'lightgrey'
                  },
                  titlefont: {
                    family: 'Arial, sans-serif',
                    size: 18,
                    color: 'black'
                  },
                },
                yaxis:{
                  title: gettitle(),
                  autorange: false,
                  range: errorrange(),
                  tickangle: 45,
                  titlefont: {
                    family: 'Arial, sans-serif',
                    size: 18,
                    color: 'black'
                  },
                  tickfont: {
                    family: 'Old Standard TT, serif',
                    size: 14,
                    color: 'lightgrey'
                  },
                  exponentformat: 'e',
                  showexponent: 'all',
                },
                margin: {
                  l: 30,
                  r: 30,
                  b: 30,
                  t: 35,
                  pad: 4
                },
                mode:'markers',
                hovermode:'closest',
                title:'Privacy Frontier '+dataset,
                showlegend: false
              };
                
              Plotly.newPlot('scatterFrontier', data, layout,{showSendToCloud: true});
              document.getElementById("true_explain").style.visibility = "visible";
              var time = 0;
                // This function below determines which noisy histogram to display, based on the point that user clicked on the frontier.
              tempPlot.on('plotly_click', function(data){
                // To uniquely identify which noisy histogram we want to display, we need 1) algorithm 2) epsilon value (x-value)
                var curr_time = new Date();
                var pts = '';
                
                //Plotly.deleteTraces('trueHist', 1);
                for(var i=0; i < data.points.length; i++){
                  document.getElementById("gif").style.visibility = "visible"
                  rankChosen = data.points[i].curveNumber;
                  if(temp_query== 1){
                    if (dp_chosen == 1){
                      if (rankChosen == 0) {
                        curveChosen = "nodeDP_degHis_Lap";
                      } else if (rankChosen == 1) {
                        curveChosen = "nodeDP_degSeq_Lap";
                      } else if (rankChosen == 2){
                        curveChosen = "nodeDP_nodeTrun_Smooth";
                      } else if (rankChosen == 3){
                        curveChosen = "nodeDP_edgeAdd_degHisPart_Lap";
                      } else if (rankChosen == 4){
                        curveChosen = "nodeDP_edgeAdd_degCum_Lap";
                      } else if (rankChosen == 5){
                        curveChosen = "nodeDP_edgeAdd_degCum_Lap_variant";
                      } 
                    } else {
                      if(rankChosen == 0){
                        curveChosen = "edgeDP_degHis_lap";
                      } else if(rankChosen == 1){
                        curveChosen = "edgeDP_degHis_lap";
                      }
                    }
                  }
                  else {
                    if(dp_chosen == 2){
                      if (rankChosen == 0) {
                        curveChosen = "Ladder";
                      } else if (rankChosen == 1) {
                        curveChosen = "LAP";
                      } else if (rankChosen == 2){
                        curveChosen = "Smooth";
                      } else if (rankChosen == 3){
                        curveChosen = "noisyls";
                      }
                    }
                  }
                    eChosen = data.points[i].x.toPrecision(1);                  
                      // Based on the dataset, algorithm, and epsilon level chosen, we determine the name of the CSV file
                      // that store the noisy histogram user has chosen 
                    var testHeight = 300; // this simply tests that we can use variables for layout parameters
                      // The following function plost the noisy histogram
                    if(dp_chosen==1) var noisyHistName =dataChosen+"algo.csv"
                    else var noisyHistName = dataChosen + "edgealgo.csv"
                    console.log("Epsilon Chosen is "+eChosen);
                    //noisyHistName = "outputmodify.csv"
                    if(eChosen == 1) eChosen = 1.0
                    else if(eChosen == 2) eChosen = 2.0
                    else if(eChosen == 5) eChosen = 5.0
                    else if(eChosen == 10) eChosen = 10.0
                    Plotly.d3.csv(noisyHistName, function(err, rows){
                      var d = rows.filter(r => ((r.epsilon == eChosen) && (r.algorithm == rankChosen+1)));
                      var l = rows.filter(r => (r.query == temp_query-1) && (r.epsilon == eChosen) && (r.algorithm == rankChosen+1))
                      var col = "count"+(time%10+1);
                      if(dp_chosen == 1) var aname = algorithms[rankChosen];
                      else var aname = edgealgorithms[rankChosen];
                      console.log("Algorithm Chosen is "+aname);
                      function unpack(rows, key) {
                        return rows.map(function(row) { return row[key]; });
                      };
                      function data_x(){
                        if(temp_query==1) return unpack(d, 'degree')
                        else return ["Noisy Count"];
                      } 
                      function data_y(){
                        if(temp_query==1) return unpack(d, col)
                        else return unpack(l, col)
                      } 
                      function get_type(){
                        if(temp_query == 1) return 'scatter';
                        else return 'bar';
                      }
                      function getcolor_data(){
                        if(temp_query != 1){
                          if(rankChosen == 0) return 'blue'
                          else if(rankChosen == 1) return 'orange'
                          else if(rankChosen == 2) return 'green'
                        }
                        else return 'orange'
                      }
                      var data = [{
                        mode: 'markers',
                        type: get_type(),
                        name: aname,
                        text: data_y(),
                        textposition: 'auto',
                        x: data_x(),
                        y: data_y(),
                        
                          color: getcolor_data(),
                      }];
                      
                      
                      if(temp_query == 1){
                        
                        var layout = {
                          autosize: false,
                          width: 300,
                          height: testHeight,
                          xaxis: {
                            title: 'degree',
                            autorange: false,
                            range: [0, 300]
                          },
                          yaxis: {
                            fixedrange: false,
                            title: 'count',
                            autorange: false
                          },
                          margin: {
                            l: 30,
                            r: 30,
                            b: 30,
                            t: 35,
                            pad: 4
                          },
                          mode:'markers',
                          hovermode:'closest',
                          title:'Noisy Histogram',
                          showlegend: false
                        };
                        Plotly.deleteTraces('trueHist', 1);
                        Plotly.plot('trueHist', data, layout);
                      }else {
                        function getcolor(){
                          if(rankChosen == 0) return 'blue'
                          else if(rankChosen == 1) return 'orange'
                          else if(rankChosen == 2) return 'green'
                        }
                        var data = [{
                          mode: 'markers',
                          type: get_type(),
                          name: aname,
                          text: data_y(),
                          textposition: 'auto',
                          x: data_x(),
                          y: data_y(),
                          marker:{ 
                            color : getcolor()
                          }
                        }];
                        var layout = {
                          autosize: false,
                          width: 250,
                          height: 300,
                          xaxis: {
                            //title: 'degree',
                            //range: getxrange(),
                            autorange: true
                          },
                          colorway: ['orange'],
                          yaxis: {
                            title: 'count',
                            type: 'log',
                            //range: getyrange(),
                            autorange: false,
                            range:[1,15]
                          },
                          margin: {
                            l: 30,
                            r: 30,
                            b: 30,
                            t: 35,
                            pad: 4
                          },
                          mode:'markers',
                          hovermode:'closest',
                          title:'Noisy Count',
                          showlegend: false
                        };
                        document.getElementById('noisyHist').style.visibility = "visible";
                        Plotly.newPlot('noisyHist',data, layout);
                      }
                      time++;
                      var finish_time = new Date();
                      console.log("Time to compute is "+(finish_time - curr_time));
                      document.getElementById("noisy_explain").style.visibility = "visible";
                      document.getElementById("noisy_detail").style.visibility = "visible";
                      document.getElementById("noisy_detail").innerHTML = "The data point being displayed is algorithm: "+aname+" ,and the epsilon chosen is "+eChosen;
                    });
                    if(dp_chosen == 1) var noisyHistName1 = dataChosen+"cdfalgo.csv"
                    else var noisyHistName1 = dataChosen + "cdfedgealgo.csv"
                    if(temp_query == 1){
                      Plotly.deleteTraces('noisyHist', 1);
                      Plotly.d3.csv(noisyHistName1, function(err, rows){
                        var d = rows.filter(r => ((r.epsilon == eChosen) && (r.algorithm == rankChosen+1)))
                        if(dp_chosen == 1) var aname = algorithms[rankChosen]
                        else var aname = edgealgorithms[rankChosen]
                        function unpack(rows, key) {
                          return rows.map(function(row) { return row[key]; });
                        }
                        var col = "count"+(time%10+1)
                        var data = [{
                          mode: 'markers',
                          name: aname,
                          x: unpack(d, 'degree'),
                          y: unpack(d, col)
                        }]
                        console.log(data);
                        var layout = {
                          autosize: true,
                          width: 300,
                          height: testHeight,
                          xaxis: {
                            type: 'log',
                            title: 'degree',
                          //autorange: true
                          },
                          yaxis: {
                            title: 'count',
                          //autorange: true
                          },
                          margin: {
                            l: 30,
                            r: 30,
                            b: 30,
                            t: 35,
                            pad: 4
                          },
                          mode:'markers',
                          hovermode:'closest',
                          title:'Noisy Histogram',
                          showlegend: false
                        };
                        Plotly.plot('noisyHist', data, layout);
                        time++;
                        
                      });
                    }
                  }
                });
                
              });
            
            
          }
          function changevisibility(i){
            var dataChosen = '';
            var temp_data = document.getElementById("Dataset").value;
            var dp_chosen = document.getElementById("Degree Type").value;
              // dataChosen stores the dataset that user has chosen
            if (temp_data == 2) {
              dataChosen = 'CIT';
            } else if (temp_data == 3) {
              dataChosen = 'DBLP';
            } 
            else if(temp_data == 1){
              dataChosen = 'FACEBOOK';
            } else if(temp_data == 4){
              dataChosen = 'WIKI';
            } else if(temp_data == 5){
              dataChosen = 'TOYDATA';
            }
            else {
              dataChosen = 'EMAIL';
            }
              // graphSource stores the source (.png) of an image of the original dataset
            console.log(algoindex);
            var graphSource = "Plot"+dataChosen+".png";
            if(dp_chosen == 1){
              if(algoindex[i] == -1){
                algoindex[i] = i+1;
              }else{
                algoindex[i] = -1;
              }
            } else {
              if(edgealgoindex[i] == -1){
                edgealgoindex[i] = i+1;
              }
              else edgealgoindex[i] = -1;
            }

            console.log(dataChosen);
            plotfrontier(dataChosen);
          }
          function DDFn() {
            // First determine which dataset we have chosen. If none is, display empty true histogram

            // In this part we should also determine which true graphs we want to show. Set source to be NULL if no dataset is selected.
            var temp_data = document.getElementById("Dataset").value;
            var dp_chosen = document.getElementById("Degree Type").value;
            if (temp_data == 2) {
              dataChosen = 'CIT';
            } else if (temp_data == 3) {
              dataChosen = 'DBLP';
            } 
            else if(temp_data == 1){
              dataChosen = 'FACEBOOK';
            } else if(temp_data == 4){
              dataChosen = 'WIKI';
            } else if(temp_data == 5){
              dataChosen = 'TOYDATA';
            }
            else {
              dataChosen = 'EMAIL';
            }
            var cdf = dataChosen+"cdf.csv";
            if(dp_chosen == 2) var lookingname = "lookingedge.csv"
            else var lookingname = "looking.csv"         
            Plotly.d3.csv(lookingname, (err, rows)=>{
              var l = rows.filter(r=>r.algo)
              algoindex = l.map(r => r.algo)
              edgealgoindex = l.map(r => r.algo);
              var k = rows.filter(r => r.algoname)
              algorithms = k.map(r=>r.algoname)
              edgealgorithms = k.map(r=>r.algoname)
              algoindex[0] = -1;
              algoindex[1] = -1;
              algoindex[2] = -1;
              if(dp_chosen == 2) {
                document.getElementById("algorithm1").checked = true;
                document.getElementById("algorithm2").checked = true;
              }
            })
            //CLear the graph after a new click on the frontier; generate a random Toy dataset; Add words for the data points;
            //Challenge: upload their own algorithm
            Plotly.d3.csv(cdf, (err,rows)=>{
              function unpack(rows, key, total) {
                return rows.map(function(row) { return row[key]; });
              }
              var trace1 = {
                mode: 'markers',
                type: 'line',
                name: 'true cdf',
                x: rows.map(function(row) { return row['degree']}),
                y: unpack(rows, 'count')
              }
              var trace2 = {}
              var data = [trace1,trace2]
              var layout = {
                autosize: true,
                width: 250,
                height: 300,
                xaxis: {
                  title: 'degree',
                  type: 'log',
                  autorange: true
                },
                yaxis: {
                  fixedrange: true,
                  zerolin: true,
                  type: 'log',
                  title: 'P(K>=k)',
                  autorange: true
                },
                margin: {
                  l: 30,
                  r: 30,
                  b: 30,
                  t: 35,
                  pad: 4
                },
                mode:'markers',
                hovermode:'closest',
                title:'CDF of the data',
                showlegend: false
                };
              Plotly.newPlot('noisyHist', data, layout);
            })
            // The folloiwng function plots the ture DD histogram of a dataset. Note that one dataset has only one true DD. 
            var trueHistName =dataChosen+'HistCSV.csv'
            Plotly.d3.csv(trueHistName, function(err, rows){

            function unpack(rows, key) {
              return rows.map(function(row) { return row[key]; });
            }

            var trace1 = {
              name: 'trueHist',
              mode: 'markers',
              type: 'bar',
              x: unpack(rows, 'degree'),
              y: unpack(rows, 'count')
            }
            var trace2 = {}
            var data = [trace1, trace2]
            var layout = {
              autosize: false,
              width: 250,
              height: 300,
              xaxis: {
                title: 'degree',
                range: getxrange(),
                //autorange: true
              },
              yaxis: {
                title: 'count',
                range: getyrange()
              },
              margin: {
                l: 30,
                r: 30,
                b: 30,
                t: 35,
                pad: 4
              },
              mode:'markers',
              hovermode:'closest',
              title:'Histogram',
              showlegend: false
            };

            Plotly.newPlot('trueHist', data, layout)

            });
            plotfrontier(dataChosen);
            document.getElementById("show_algorithm").style.visibility = "visible";
        };

          function SGCFn() {
            var temp_data = document.getElementById("Dataset").value;
            var temp_query = document.getElementById("Utility").value;
            var dp_chosen = document.getElementById("Degree Type").value;
            if (temp_data == 2) {
              dataChosen = 'CIT';
            } else if (temp_data == 3) {
              dataChosen = 'DBLP';
            } 
            else if(temp_data == 1){
              dataChosen = 'FACEBOOK';
            } else if(temp_data == 4){
              dataChosen = 'WIKI';
            } else if(temp_data == 5){
              dataChosen = 'TOYDATA';
            }
            else {
              dataChosen = 'EMAIL';
            }
            
            var lookingname = "lookingSGC";
            // This part draws the frontier 
            if(dp_chosen == 2) lookingname = lookingname+"edge"
            lookingname = lookingname + ".csv"       
            Plotly.d3.csv(lookingname, (err, rows)=>{
              var l = rows.filter(r=>r.algo)
              algoindex = l.map(r => r.algo)
              edgealgoindex = l.map(r => r.algo);
              var k = rows.filter(r => r.algoname)
              algorithms = k.map(r=>r.algoname)
              edgealgorithms = k.map(r=>r.algoname)
              //algoindex[0] = -1;
              //algoindex[1] = -1;
              //algoindex[2] = -1;
              if(dp_chosen == 2) {
                document.getElementById("algorithm1").checked = true;
                document.getElementById("algorithm2").checked = true;
                if(temp_query != 1) document.getElementById("algorithm3").checked = true;
              }
            })
            if(dp_chosen == 1)var trueHistName = dataChosen+'SGCHistCSV.csv'
            else var trueHistName = dataChosen + 'SGCHistCSVedge.csv'
            Plotly.d3.csv(trueHistName, function(err, rows){

            var d = rows.filter(r => (r.query == temp_query-1))
            function unpack(rows, key) {
              return rows.map(function(row) { return row[key]; });
            }
            var trace1 = {
              name: 'trueHist',
              type: 'bar',
              text: unpack(d, 'count'),
              textposition: 'auto',
              marker: {
                color: 'purple'
              },
              x: ["True count"],
              y: unpack(d, 'count')
            }
            var trace2 = {}
            var data = [trace1, trace2]
            var layout = {
              autosize: false,
              width: 250,
              height: 300,
              xaxis: {
                //title: 'degree',
                //range: getxrange(),
                autorange: true
              },
              yaxis: {
                title: 'count',
                type: 'log',
                //range: getyrange(),
                autorange: false,
                range:[1,15]
              },
              margin: {
                l: 30,
                r: 30,
                b: 30,
                t: 35,
                pad: 4
              },
              mode:'markers',
              hovermode:'closest',
              title:'True Count',
              showlegend: false
            };

            Plotly.newPlot('trueHist', data, layout)

            });
            plotfrontier(dataChosen);
            document.getElementById("show_algorithm").style.visibility = "visible";
        };
        var animation = 1;
        function started(){  
          if(animation == 1){
            console.log("start");
            animation = 2;
            time = 6;
            gif(1);
          } else {
            animation = 1;
            console.log("stop")
            time = 11;
          }
        }
        function gif(type_chosen){
          if(time >10) return;
          var dataChosen = '';
          var dp_chosen = document.getElementById("Degree Type").value;
          var temp_data = document.getElementById("Dataset").value;
          var temp_query = document.getElementById("Utility").value;
              // dataChosen stores the dataset that user has chosen
          if (temp_data == 2) {
            dataChosen = 'CIT';
          } else if (temp_data == 3) {
            dataChosen = 'DBLP';
          } 
          else if(temp_data == 1){
            dataChosen = 'FACEBOOK';
          } else if(temp_data == 4){
            dataChosen = 'WIKI';
          } else if(temp_data == 5){
            dataChosen = 'TOYDATA';
          }
          else {
            dataChosen = 'EMAIL';
          }
          if(temp_query == 1){
            if(dp_chosen == 1 && type_chosen == 1) var noisyHistName = dataChosen+"algo.csv"
            else if(dp_chosen == 2 && type_chosen == 1)var noisyHistName = dataChosen + "edgealgo.csv"
            else if(dp_chosen == 1 && type_chosen == 2)var noisyHistName = dataChosen + "cdfalgo.csv"
            else var noisyHistName = dataChosen + "cdfedgealgo.csv"
            Plotly.d3.csv(noisyHistName, function(err, rows){
              var d = rows.filter(r => ((r.epsilon == eChosen) && (r.algorithm == rankChosen+1)))
              if(dp_chosen == 1) var aname = algorithms[rankChosen]
              else var aname = edgealgorithms[rankChosen]
              function unpack(rows, key) {
                return rows.map(function(row) { return row[key]; });
              }
              var col = "count"+time
              console.log(col)
              if(time >10) return;
              var data = [{
                mode: 'markers',
                name: "test",
                x: unpack(d, 'degree'),
                y: unpack(d, col)
              }]
              var layout = {
                autosize: true,
                width: 300,
                height: 300,
                xaxis: {
                  type: 'log',
                  
                },
                yaxis: {
                  title: 'count',
                },
                margin: {
                  l: 30,
                  r: 30,
                  b: 30,
                  t: 35,
                  pad: 4
                },
                mode:'markers',
                hovermode:'closest',
                title:'Noisy Histogram',
                showlegend: false
              };
              if(type_chosen == 1){
                Plotly.deleteTraces('trueHist', 1);
                Plotly.plot('trueHist', data, layout);
              } else {
                Plotly.deleteTraces('noisyHist', 1);
                Plotly.plot('noisyHist', data, layout);
              }            
              if(type_chosen == 2) time++;
              if(time == 11) time = 1;
              if(type_chosen == 1) gif(2);
              else gif(1)
            })
          } else {//This is for SGC
            if(dp_chosen == 2) var noisyHistName = dataChosen+"SGCedgealgo.csv"
            Plotly.d3.csv(noisyHistName,function(err, rows){
              var d = rows.filter(r => ((r.epsilon == eChosen) && (r.algorithm == rankChosen+1) && (r.query == temp_query - 1)))
              if(dp_chosen == 1) var aname = algorithms[rankChosen]
              else var aname = edgealgorithms[rankChosen]
              function unpack(rows, key) {
                return rows.map(function(row) { return row[key]; });
              }
              var col = "count"+time
              console.log(col)
              if(time >10) return;
              var data = [{
                mode: 'markers',
                type: 'bar',
                textposition: 'auto',
                text: unpack(d, col),
                name: aname,
                x: ["Noisy Count"],
                y: unpack(d, col)
              }]
              var layout = {
                autosize: true,
                width: 250,
                height: 300,
                xaxis: {
                  
                },
                colorway: ['orange'],
                yaxis: {
                  type: 'log',
                  title: 'count',
                  autorange: false,
                  range:[1,15]
                },
                margin: {
                  l: 30,
                  r: 30,
                  b: 30,
                  t: 35,
                  pad: 4
                },
                mode:'markers',
                hovermode:'closest',
                title:'Noisy Histogram',
                showlegend: false
              };
              Plotly.newPlot('noisyHist', data, layout);
              if(type_chosen == 2) time++;
              if(time == 11) time = 1;
              if(type_chosen == 1) gif(2);
              else gif(1)
            })
          }
          
          
        }
        function frontierFn() {
          prepare();
          document.getElementById("show_algorithm").style.visibility = "visible";
          if (document.getElementById("Utility").value == 1) {
            document.getElementById("trueHist").style.visibility = "visible";
            document.getElementById("noisyHist").style.visibility = "visible";
            DDFn();
            
          } else {
            document.getElementById("trueHist").style.visibility = "visible";
            document.getElementById("noisyHist").style.visibility = "hidden";
            SGCFn();
          }
        }
      
      </script>
        <!-- Following are the four graphs we want to display on the page: privacy frontier, true Hist, noisy Hist, and image of dataset -->

        <div id="DDContainer">
          <div style="float: left;" id="trueHist" class="trueHist"></div>
          <div style="float: left;" id="noisyHist" class="noisyHist"></div>
          <div style="float: left;" id="scatterFrontier"></div>
          <button id = "show_algorithm" onclick = "show_algorithm()">show algorithms</button><br>
          <form id = "select_algorithm_DD">
            <p>Please select the algorithm you want to display</p>
            <input type = "checkbox" onclick = "changevisibility(0)" id = "algorithm1">
            <span id="nodedp_algo1" style="display:inline; color:blue;">degHis_Lap.</span>
            <span id="sgcedgedp_algo1" style="display:inline; color:blue;">Ladder.</span>
            <span id="edgedp_algo1" style="display:none; color:blue;">degHis_Lap</span><br>
            <input type = "checkbox" onclick = "changevisibility(1)" id = "algorithm2">
            <span id="nodedp_algo2" style="display:inline; color:orange;">degSeq_Lap</span>
            <span id="sgcedgedp_algo2" style="display:inline; color:orange;">LAP</span>
            <span id="edgedp_algo2" style="display:none; color:orange;">degSeq_Lap</span><br>
            <input type = "checkbox" onclick = "changevisibility(2)" id = "algorithm3">
            <span id="sgcedgedp_algo3" style="display:inline; color:green;">Smooth</span>
            <span id="nodedp_algo3" style="display:inline; color:green;">nodeTrun_Smooth</span><br>
            <input type = "checkbox" onclick = "changevisibility(3)" id = "algorithm4">
            <span id="nodedp_algo4" style="display:inline; color:red;">edgeAdd_degHisPart_Lap</span><br>
            <input type = "checkbox" onclick = "changevisibility(4)" id = "algorithm5">
            <span id="nodedp_algo5" style="display:inline; color:purple;">edgeAdd_degCum_Lap</span><br>
            <input type = "checkbox" onclick = "changevisibility(5)" id = "algorithm6">
            <span id="nodedp_algo6" style="display:inline; color:brown;">edgeAdd_degCum_Lap_variant</span><br>
          </form><br>
          <br>
          <br>
          <button id="gif" onclick="started()">Animate</button>
          <p id="true_explain">The <span style="color:blue;font-weight:bold;">blue</span> graph represent the true dataset. </p>
          <p id="noisy_explain">The <span style="color:orange;font-weight:bold;">orange</span> graph represent the noisy dataset</p>
          <p id="noisy_detail">The data point being displayed is algorithm: ,and the epsilon chosen is </p>
          
          
          <p><a href="uploading.html">Upload your own algorithm</a></p>
          
          
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          
          
        </div>

        <br>

  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>
